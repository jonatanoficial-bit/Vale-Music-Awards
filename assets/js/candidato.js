(function(){const f=document.getElementById("cf");const out=document.getElementById("out");if(!f||!out)return;
async function show(code){const cands=await vpLoadCandidates();const c=cands.find(x=>String(x.id||"").toUpperCase()===String(code||"").toUpperCase());if(!c)return alert("Código não encontrado.");const a=vpAggregate(c.id);out.innerHTML=`<div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap"><img src="${c.foto||'../assets/img/vale-producao-logo.png'}" style="width:70px;height:70px;border-radius:22px;object-fit:cover;border:1px solid rgba(255,255,255,.10)"/><div><div style="font-weight:950;font-size:18px">${c.nomeArtistico||c.nome}</div><div style="color:var(--muted2);font-size:12px">${c.id} • ${c.genero||"—"} • ${c.cidade||""}</div></div></div>
<div style="margin-top:12px" class="card"><div style="padding:14px"><b>Média:</b> ${(a?a.weighted:0).toFixed(2)} • <span style="color:var(--muted2)">${a?`${a.judgesCount} jurado(s)`:"Sem notas ainda"}</span><div style="margin-top:10px;color:var(--muted)">${a?.note?`<b>Feedback:</b> ${a.note}`:"Sem feedback."}</div>${c.audio?`<div style="margin-top:12px"><audio controls style="width:100%"><source src="${c.audio}"></audio></div>`:""}</div></div>`;}
const sess=vpReadJSON(VP_STORE_KEYS.candSession,null);if(code=sess?.code) show(code);
f.addEventListener("submit",(e)=>{e.preventDefault();const fd=new FormData(f);const code=String(fd.get("code")||"").trim();vpWriteJSON(VP_STORE_KEYS.candSession,{code,at:new Date().toISOString()});show(code);});})();